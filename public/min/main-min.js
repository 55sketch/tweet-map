function init(){var e=[],t=document.getElementById("search-term").value,n=document.getElementById("range").value,o=document.getElementById("postcode").value,s=new XMLHttpRequest;s.open("GET","https://api.postcodes.io/postcodes/"+o),s.onload=function(){if(200===s.status){var o=JSON.parse(s.responseText);e.push("lat="+o.result.latitude,"lon="+o.result.longitude),console.log(e),t&&e.push("q="+encodeURIComponent(t)),n&&e.push("range="+n+"mi");var a=e.join("&");renderTwitterMap(a,o.result.latitude,o.result.longitude)}},s.send()}function renderTwitterMap(e,t,n){console.log(e,t,n);var o=new XMLHttpRequest;o.open("GET","/api?"+e),o.onload=function(){if(200===o.status){document.getElementById("map").classList.remove("loading");var e=L.mapbox.map("map","mapbox.streets",{center:[t,n],zoom:7}),s=JSON.parse(o.responseText);console.log(s);for(var a=s.length-1;a>=0;a--){var i=s[a],r=i.place.bounding_box.coordinates[0][0][1],l=i.place.bounding_box.coordinates[0][0][0];if(i.entities.media)var d='<img src="'+i.entities.media[0].media_url_https+'"/>';else var d="";var m=L.marker([r,l]).addTo(e),u='<img src="'+i.user.profile_image_url_https+'" class="profile-image" /><h3 class="screen-name">'+i.user.screen_name+"</h3>"+d+"<p>"+i.text+'</p><a href="https://twitter.com/statuses/'+i.id_str+'"/>Link</a>';m.bindPopup(u)}}else console.log("Request failed.  Returned status of "+o.status)},o.send()}function formSubmit(e){e.preventDefault(),map.remove(),document.getElementById("map-container").innerHTML='<div id="map" class="loading"></div>',init()}L.mapbox.accessToken="pk.eyJ1Ijoibmlja21vcmV0b24iLCJhIjoiN1YzbVQ4OCJ9.LtxClALVgG8k2DCnA5vX-A",document.getElementById("search-form").addEventListener("submit",formSubmit,!1),init();